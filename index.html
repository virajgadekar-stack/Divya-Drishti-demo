<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Divya Drishti | Smart Farmer</title>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script src='https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js'></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="success-msg">
        <div class="success-icon">‚úì</div>
        <h2>Success!</h2>
        <p>Welcome to Divya Drishti</p>
    </div>

    <div class="app-container">
        
        <header id="main-header">
            <div class="header-content">
                <div class="logo-circle">üëÅÔ∏è</div>
                <div class="header-text">
                    <h1>Divya Drishti</h1>
                    <span>Smart Farming Assistant</span>
                </div>
            </div>
            <button class="logout-btn-mini" onclick="logoutUser()">‚èª</button>
        </header>

        <div id="login-screen" class="screen active-screen">
            <div class="login-card">
                <div class="logo-large">üëÅÔ∏è</div>
                <h3>Kisan Registration</h3>
                <p>Join the smart revolution</p>
                
                <div class="input-group">
                    <input type="text" id="fname" placeholder="Full Name">
                </div>
                <div class="input-group">
                    <select id="state-select" onchange="loadDistricts()">
                        <option value="">Select State</option>
                    </select>
                </div>
                <div class="input-group">
                    <select id="district-select" onchange="loadVillages()" disabled>
                        <option value="">Select District</option>
                    </select>
                </div>
                <div class="input-group">
                    <select id="village-select" disabled>
                        <option value="">Select Village</option>
                    </select>
                </div>
                
                <div class="divider"><span>Crops</span></div>

                <div class="input-group">
                    <select id="crop-count" onchange="generateCropFields()">
                        <option value="">Number of Crops</option>
                        <option value="1">1</option> <option value="2">2</option> <option value="3">3</option>
                    </select>
                </div>
                <div id="dynamic-crop-area"></div>

                <button class="btn-main" onclick="submitRegistration()">Get Started</button>
            </div>
        </div>

        <div id="dashboard-screen" class="screen">
            
            <div class="weather-widget" onclick="getRealWeather()">
                <div class="weather-icon">‚õÖ</div>
                <div class="weather-info">
                    <h2 id="weather-temp">--¬∞C</h2>
                    <p id="weather-desc">Tap to update</p>
                    <span id="location-text" style="font-size:11px; opacity:0.8;">üìç Locating...</span>
                </div>
            </div>

            <h3 class="section-title">Quick Actions</h3>
            
            <div class="grid-menu">
                <div class="menu-item" onclick="openScanner()">
                    <div class="icon-box" style="background: linear-gradient(135deg, #FF6B6B, #EE5253);">üì∑</div>
                    <span>Satya Scan</span>
                </div>
                <div class="menu-item" onclick="openAdvisor()">
                    <div class="icon-box" style="background: linear-gradient(135deg, #48DBFB, #0ABDE3);">ü§ñ</div>
                    <span>Agri Gyani</span>
                </div>
                <div class="menu-item" onclick="openMandi()">
                    <div class="icon-box" style="background: linear-gradient(135deg, #Feca57, #ff9f43);">üí∞</div>
                    <span>Mandi Bhav</span>
                </div>
                <div class="menu-item" onclick="openPoshan()">
                    <div class="icon-box" style="background: linear-gradient(135deg, #1dd1a1, #10ac84);">üå±</div>
                    <span>Poshan</span>
                </div>
            </div>

            <div class="daily-tip-card">
                <h4>üí° Daily Tip</h4>
                <p>Check for yellow rust in Wheat this week. Irrigating in the evening saves 30% water.</p>
            </div>
        </div>

        <div id="scan-interface" class="screen">
            <div class="screen-header">
                <button class="back-btn" onclick="goHome()">‚ùÆ</button>
                <h3>Satya Scan</h3>
            </div>
            
            <div class="scanner-container">
                <div id="reader"></div>
                <div class="scan-overlay">
                    <div class="scan-line"></div>
                    <div class="corner tl"></div><div class="corner tr"></div>
                    <div class="corner bl"></div><div class="corner br"></div>
                </div>
            </div>
            
            <div class="scanner-controls">
                <p>Point camera at QR / Barcode</p>
                <div class="btn-row">
                    <button class="btn-icon" onclick="startScanner()">üì∑ <br>Start</button>
                    <button class="btn-icon" onclick="captureAndReadText()">üìù <br>OCR</button>
                </div>
                <div id="scan-timer">02:00</div>
            </div>
        </div>

        <div id="scan-result-screen" class="screen">
            <div class="result-card" id="res-card-bg">
                <div id="res-icon" class="result-icon">üîç</div>
                <h2 id="res-status">Analyzing...</h2>
                <h4 id="res-name">Please wait</h4>
                <p id="res-msg">Verifying product details from database...</p>
                <div class="result-details">
                    <span>Expiry: <b id="res-exp">--</b></span>
                </div>
                <button class="btn-main" onclick="exitScanResult()">Scan Another</button>
            </div>
        </div>

        <div id="poshan-interface" class="screen">
            <div class="screen-header">
                <button class="back-btn" onclick="goHome()">‚ùÆ</button>
                <h3>Poshan Tracker</h3>
            </div>
            
            <div class="tab-container">
                <button class="tab active" onclick="switchPoshanTab('log')">Logbook</button>
                <button class="tab" onclick="switchPoshanTab('advisory')">Advisory</button>
            </div>

            <div id="tab-log" class="tab-content active-content">
                <div class="add-log-box">
                    <input type="text" id="log-item-name" placeholder="Item Name (e.g. Urea)">
                    <input type="date" id="log-item-date">
                    <button class="btn-mini" onclick="addToLog()">+ Add</button>
                </div>
                <div class="log-history">
                    <ul id="log-list">
                        </ul>
                </div>
            </div>

            <div id="tab-advisory" class="tab-content">
                <div class="advice-form">
                    <label>Select Crop</label>
                    <select id="advisory-crop-select"></select>
                    <label>Crop Age (Days)</label>
                    <input type="number" id="crop-age-days" placeholder="e.g. 30">
                    <button class="btn-main" onclick="getFertilizerAdvice()">Get Advice</button>
                </div>
                <div id="advisory-output" class="advice-result-box"></div>
            </div>
        </div>

        <div id="advisor-interface" class="screen full-height">
            <div class="chat-header">
                <button class="back-btn-white" onclick="goHome()">‚ùÆ</button>
                <div class="bot-info">
                    <div class="bot-avatar">üë≥üèΩ‚Äç‚ôÇÔ∏è</div>
                    <div>
                        <h3>Agri Gyani</h3>
                        <span>Online</span>
                    </div>
                </div>
            </div>
            
            <div id="chat-history" class="chat-area">
                <div class="msg bot">
                    <div class="bubble">Namaste! I am your AI farming assistant. Ask me about weather, diseases, or prices.</div>
                </div>
            </div>

            <div class="chat-input-bar">
                <button class="voice-btn" id="mic-btn" onclick="startVoiceInput()">üé§</button>
                <input type="text" id="advice-query" placeholder="Ask a question..." onkeypress="handleChatEnter(event)">
                <button class="send-btn" onclick="sendChat()">‚û§</button>
            </div>
        </div>

        <div id="mandi-interface" class="screen">
            <div class="screen-header">
                <button class="back-btn" onclick="goHome()">‚ùÆ</button>
                <h3>Mandi Rates</h3>
            </div>
            <div class="mandi-card">
                <div id="mandi-table-container">Loading...</div>
            </div>
        </div>

    </div>

    <script src="script.js"></script>
</body>
</html>
