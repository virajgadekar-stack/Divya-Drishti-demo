<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Divya Drishti | Smart Farmer App</title>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script src='https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js'></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="success-msg">
        <div class="shield-logo" style="transform: scale(1.5); margin-bottom: 20px;"></div>
        <h2 style="margin:0;">REGISTRATION SUCCESSFUL!</h2>
        <p>Redirecting to Dashboard...</p>
    </div>

    <header>
        <div class="shield-logo"></div>
        <h1>Divya Drishti</h1>
        <div style="font-size: 12px; opacity: 0.8;">Secure. Smart. Sustainable.</div>
    </header>

    <div class="container">
        
        <div id="login-screen" class="card">
            <h3 style="margin-top:0; text-align:center;">Farmer Registration</h3>
            
            <div class="input-group">
                <label>Full Name</label>
                <div class="valid-wrap">
                    <input type="text" id="fname" placeholder="Enter Farmer Name" oninput="validateField(this, 'text')">
                    <span class="tick-mark">‚úî</span>
                </div>
            </div>

            <div class="input-group">
                <label>State</label>
                <div class="valid-wrap">
                    <select id="state-select" onchange="loadDistricts(); validateField(this, 'select')">
                        <option value="">-- Select State --</option>
                    </select>
                    <span class="tick-mark">‚úî</span>
                </div>
            </div>

            <div class="input-group">
                <label>District</label>
                <div class="valid-wrap">
                    <select id="district-select" onchange="loadVillages(); validateField(this, 'select')" disabled>
                        <option value="">-- Select District --</option>
                    </select>
                    <span class="tick-mark">‚úî</span>
                </div>
            </div>

            <div class="input-group">
                <label>Village / Town</label>
                <div class="valid-wrap">
                    <select id="village-select" onchange="validateField(this, 'select')" disabled>
                        <option value="">-- Select Village --</option>
                    </select>
                    <span class="tick-mark">‚úî</span>
                </div>
            </div>

            <div class="input-group">
                <label>Number of Crops (1-10)</label>
                <div class="valid-wrap">
                    <select id="crop-count" onchange="generateCropFields(); validateField(this, 'select')">
                        <option value="">-- Select --</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                    </select>
                    <span class="tick-mark">‚úî</span>
                </div>
            </div>

            <div id="dynamic-crop-area"></div>

            <button class="btn-primary" onclick="submitRegistration()">REGISTER & LOGIN</button>
        </div>

        <div id="dashboard-screen">
            <div class="card weather-card">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <h3 id="welcome-text" style="color:white; margin:0;">Welcome!</h3>
                        <p id="location-text" style="margin:5px 0 0; opacity:0.9; font-size:13px;">Location: Unknown</p>
                    </div>
                    <div style="text-align:right; cursor: pointer;" onclick="getRealWeather()" title="Tap to refresh weather">
                        <div id="weather-temp" style="font-size: 28px; font-weight:bold;">--¬∞C</div>
                        <div id="weather-desc" style="font-size: 12px;">Tap to Load Weather</div>
                    </div>
                </div>
            </div>

            <h3 style="text-align: center; margin-bottom: 10px;">Services</h3>
            <div class="dashboard-grid">
                <div class="flashy-icon" onclick="openScanner()">
                    <span class="icon-symbol">üì∑</span>
                    <div class="icon-title">SATYA SCAN</div>
                </div>
                <div class="flashy-icon" onclick="openAdvisor()">
                    <span class="icon-symbol">üåæ</span>
                    <div class="icon-title">AGRI GYANI</div>
                </div>
                <div class="flashy-icon" onclick="openMandi()">
                    <span class="icon-symbol">üí∞</span>
                    <div class="icon-title">MANDI RATES</div>
                </div>
                <div class="flashy-icon" onclick="openPoshan()">
                    <span class="icon-symbol">üß™</span>
                    <div class="icon-title">POSHAN TRACKER</div>
                </div>
            </div>

            <button class="btn-logout" onclick="logoutUser()">üö™ Logout</button>
        </div>

        <div id="scan-interface">
            <button class="back-btn" onclick="goHome()">‚Üê Back to Home</button>
            <div class="card">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h3>üì∑ Satya Scan</h3>
                    <span id="scan-timer" style="color:red; font-weight:bold; font-size:14px; visibility: hidden;">02:00</span>
                </div>
                
                <div id="reader" style="width:100%; min-height: 250px; background: #000;"></div>
                
                <div id="scanner-controls" style="margin-top:15px; display:none;">
                    <p style="font-size:12px; text-align:center; color:#666;">Align Code within the box.</p>
                    <button class="btn-outline" id="snap-text-btn" onclick="captureAndReadText()">üìù Read Text (OCR)</button>
                </div>

                <button class="btn-primary" id="scan-btn" onclick="startScanner()">START CAMERA</button>
                <div id="ocr-status" style="text-align:center; font-size:12px; color:blue; margin-top:5px;"></div>
            </div>
        </div>

        <div id="scan-result-screen">
            <div class="card">
                <h3 style="text-align: center;">Scan Results</h3>
                <label>Detected Content:</label>
                <div id="res-code-top" class="scan-code-display">Pending...</div>
                <div id="res-box-large" class="result-large">Verifying...</div>
                <button class="btn-outline" onclick="exitScanResult()">DONE / SCAN NEXT</button>
            </div>
        </div>

        <div id="poshan-interface">
            <button class="back-btn" onclick="goHome()">‚Üê Back to Home</button>
            <div style="display:flex; gap:10px; margin-bottom:15px;">
                <button id="btn-log-tab" class="tab-btn active-tab" onclick="switchPoshanTab('log')">üìù Khad Bahi</button>
                <button id="btn-adv-tab" class="tab-btn" onclick="switchPoshanTab('advisory')">üìÖ Fasal Salah</button>
            </div>

            <div id="tab-log" class="card">
                <h3>üß™ Fertilizer Log</h3>
                <div class="input-group">
                    <input type="text" id="log-item-name" placeholder="Fertilizer Name (e.g. Urea)">
                    <input type="date" id="log-item-date">
                    <button class="btn-primary" style="margin-top:10px; padding:10px;" onclick="addToLog()">Add to Log</button>
                </div>
                <ul id="log-list" class="log-list"><li class="empty-msg">No records yet.</li></ul>
            </div>

            <div id="tab-advisory" class="card" style="display:none;">
                <h3>üìÖ Stage-wise Advisory</h3>
                <label>Select Your Crop</label>
                <select id="advisory-crop-select"></select>
                <label>Days Since Sowing</label>
                <input type="number" id="crop-age-days" placeholder="e.g. 25">
                <button class="btn-primary" onclick="getFertilizerAdvice()">GET RECOMMENDATION</button>
                <div id="advisory-output" class="advisory-box" style="display:none;"></div>
            </div>
        </div>

        <div id="advisor-interface" style="height: 90vh; display: none; flex-direction: column;">
            <div style="padding: 10px; background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); z-index: 10;">
                <button class="back-btn" onclick="goHome()" style="margin:0;">‚Üê Home</button>
                <span style="font-weight:bold; margin-left: 10px; font-size: 18px;">üåæ Agri-Gyani</span>
            </div>
            
            <div id="chat-history" class="chat-history">
                <div class="chat-msg bot-msg">
                    Namaste! I am Agri-Gyani. Ask me about crop diseases, weather, or mandi prices.
                </div>
            </div>

            <div class="chat-input-area">
                <button id="mic-btn" class="mic-btn-small" onclick="startVoiceInput()">üé§</button>
                <input type="text" id="advice-query" placeholder="Type your question..." onkeypress="handleChatEnter(event)">
                <button class="send-btn" onclick="sendChat()">‚û§</button>
            </div>
        </div>

        <div id="mandi-interface">
            <button class="back-btn" onclick="goHome()">‚Üê Back to Home</button>
            <div class="card">
                <h3>üí∞ Mandi Bhav (Today)</h3>
                <div id="mandi-table-container">Loading...</div>
            </div>
        </div>

    </div>

    <script src="script.js"></script>
</body>
</html>
